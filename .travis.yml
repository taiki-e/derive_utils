language: rust
sudo: false
cache: cargo

matrix:
  fast_finish: true

  allow_failures:
    - rust: nightly
      env: ALLOW_FAILURES=true

  include:
    - rust: 1.30.0
    - rust: stable
    - rust: beta
    - rust: nightly
      script:
        - cargo test
        - cargo doc --no-deps
        - cd "${TRAVIS_BUILD_DIR}/examples/example"
        - cargo run --bin example

    - rust: nightly
      name: cargo test (minimal versions)
      env: ALLOW_FAILURES=true
      script:
        - cargo update -Zminimal-versions
        - cargo test

    - rust: nightly
      name: cargo clippy
      script:
        - if rustup component add clippy-preview;
          then
            cargo clippy --all --all-features -- -Dwarnings;
          else
            echo 'Skipping clippy';
          fi

before_script:
  - set -o errexit

script:
  - cargo test
  - cd "${TRAVIS_BUILD_DIR}/examples/example"
  - cargo run --bin example

notifications:
  email: false
